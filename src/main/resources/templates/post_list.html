<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Danh sách bài đăng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@40,400,0,0&icon_names=favorite" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
</head>
<body class="bg-gray-100">
<div>
    <nav class="bg-white shadow-sm p-4">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo / Trang chủ -->
            <a class="text-xl font-bold text-blue-600" href="/home">Trang chủ</a>

            <!-- Nút Toggle cho mobile -->
            <button class="lg:hidden text-gray-600 focus:outline-none" id="menu-toggle">
                <i class="fas fa-bars text-xl"></i>
            </button>

            <!-- Menu chính -->
            <div class="hidden lg:flex space-x-6 items-center" id="navbar-menu">
                <a class="text-gray-700 hover:text-blue-500" href="/post/list">Danh sách bài đăng</a>
                <th:block sec:authorize="hasRole('applicant')">
                    <a class="text-gray-700 hover:text-blue-500" href="/cv/list-post-applied">Danh sách công việc đã apply</a>
                    <a class="text-gray-700 hover:text-blue-500" href="/post/postFollowed">Followed Post</a>
                    <a class="text-gray-700 hover:text-blue-500" href="/post/companyFollowed">Followed Company</a>

                </th:block>
                <th:block sec:authorize="hasRole('recruiter')">
                    <a href="/post/showFormForAdd" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Đăng bài</a>
                    <a href="/cv/list" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Duyệt CV</a>
                </th:block>

                <!-- Hiển thị nếu chưa đăng nhập -->
                <th:block th:if="${#authorization.expression('isAnonymous()')}">
                    <a class="px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-500 hover:text-white transition" href="/user/login">Đăng nhập</a>
                    <a class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition" href="/user/form-register">Đăng ký</a>
                </th:block>

                <!-- Hiển thị nếu đã đăng nhập -->
                <th:block th:if="${#authorization.expression('isAuthenticated()')}">
                    <a class="text-gray-700 hover:text-blue-500" href="/user/profile">Hồ sơ</a>
                    <form th:action="@{/logout}" method="post">
                        <button class="text-red-500 hover:text-red-600" type="submit">Đăng xuất</button>
                    </form>
                </th:block>
            </div>
        </div>
    </nav>
</div>
<div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white py-8">
    <div class="container mx-auto text-center">
        <div class="text-sm">
            <a href="#" class="text-white">TRANG CHỦ</a> &gt; <span>DANH SÁCH</span>
        </div>
        <h1 class="text-4xl font-bold mt-2">Danh sách bài đăng</h1>
    </div>
</div>



<div class="job-list">
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>

    <th:block th:each="tempPost : ${postList}">
        <div class="job-post-item p-6 mb-6 rounded-xl shadow bg-white transition hover:shadow-md">

            <div class="flex justify-between items-start">
                <!-- Thông tin chính -->
                <div class="flex-1 cursor-pointer"
                     th:onclick="'window.location.href=\'/post/detail/' + ${tempPost.id} + '\';'">
                    <div class="text-blue-500 font-semibold text-sm" th:text="${tempPost.jobType}"></div>
                    <div class="text-2xl font-bold mt-1 text-gray-800 hover:text-blue-600 transition" th:text="${tempPost.title}"></div>
                    <div class="text-gray-600 mt-2 flex items-center">
                        <i class="fas fa-building mr-2"></i>
                        <span th:text="${tempPost.company.name}"></span>
                    </div>

                    <!-- Categories -->
                    <div class="flex flex-wrap mt-3">
                        <a th:each="category : ${tempPost.categoryList}"
                           th:href="@{/post/allPostByCategory(categoryId=${category.id})}"
                           class="bg-gray-200 text-gray-700 text-sm px-3 py-1 rounded-full mr-2 mb-2 hover:bg-gray-300 transition">
                            <span th:text="${category.name}"></span>
                        </a>
                    </div>
                </div>

                <!-- Các nút hành động bên phải -->
                <div class="flex flex-col items-end space-y-2 ml-4">

                    <!-- Nếu chưa đăng nhập -->
                    <div sec:authorize="isAnonymous()">
                        <a th:href="@{/user/login}"
                           class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                            Đăng nhập để Apply
                        </a>
                    </div>

                    <!-- Nếu là recruiter -->
                    <div class="flex space-x-2" sec:authorize="hasRole('recruiter')">
                        <a th:href="@{/post/showFormForUpdate(postId=${tempPost.id})}"
                           class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 transition text-sm">Cập nhật</a>
                        <a th:href="@{/post/delete(postId=${tempPost.id})}"
                           onclick="return confirm('Bạn có muốn xóa bài đăng này?')"
                           class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition text-sm">Xóa</a>
                    </div>

                    <!-- Nếu là applicant -->
                    <div class="flex items-center space-x-2" sec:authorize="hasRole('applicant')">
                        <a th:href="@{/post/addPostFollow(postId=${tempPost.id})}" title="Theo dõi">
                            <span class="material-symbols-outlined text-red-500 hover:text-red-600">favorite</span>
                        </a>
                        <a th:if="${!appliedPost.contains(tempPost)}"
                           th:href="@{/post/applyJob(postId=${tempPost.id})}"
                           onclick="return confirm('Bạn có muốn apply công việc này?')"
                           class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition text-sm">
                            Apply
                        </a>
                        <span th:if="${appliedPost.contains(tempPost)}"
                              class="bg-gray-400 text-white px-4 py-2 rounded-lg text-sm cursor-not-allowed">
                        Applied
                    </span>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

</div>
</div>

<!----------------------------------------------------->


<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">

        <!-- Nút Previous -->
        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
            <a th:if="${request =='/post/list'}" class="page-link" th:href="@{${request}(page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByCategory'} " class="page-link" th:href="@{/post/allPostByCategory(categoryId=${categoryId},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByTitle'} " class="page-link" th:href="@{/post/allPostByTitle(title=${title},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByCompanyName'} " class="page-link" th:href="@{/post/allPostByCompanyName(keySearchCompany=${keySearchCompany},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByAddress'} " class="page-link" th:href="@{/post/allPostByAddress(address=${address},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/postOfCompany'} " class="page-link" th:href="@{/post/postOfCompany(companyId=${companyId},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>

        <!-- Các số trang -->
        <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPage)}"
            th:classappend="${i == currentPage} ? 'active'">
            <a th:if="${request =='/post/list'}" class="page-link" th:href="@{${request}(page=${i})}" th:text="${i}"></a>
            <a th:if="${request == '/post/allPostByCategory'} " class="page-link" th:href="@{/post/allPostByCategory(categoryId=${categoryId},page=${i})}"  th:text="${i}">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByTitle'} " class="page-link" th:href="@{/post/allPostByTitle(title=${title},page=${i})}"  th:text="${i}">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByCompanyName'} " class="page-link" th:href="@{/post/allPostByCompanyName(keySearchCompany=${keySearchCompany},page=${i})}"  th:text="${i}">
                <span aria-hidden="true">&laquo;</span>
            </a>

            <a th:if="${request == '/post/allPostByAddress'} " class="page-link" th:href="@{/post/allPostByAddress(address=${address},page=${i})}"  th:text="${i}">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a th:if="${request == '/post/postOfCompany'} " class="page-link" th:href="@{/post/postOfCompany(companyId=${companyId},page=${i})}"  th:text="${i}">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>

        <!-- Nút Next -->
        <li class="page-item" th:classappend="${currentPage == totalPage} ? 'disabled'">
            <a th:if="${request =='/post/list'}"  class="page-link" th:href="@{${request}(page=${currentPage + 1})}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByCategory'} " class="page-link" th:href="@{/post/allPostByCategory(categoryId=${categoryId},page=${currentPage +1})}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByTitle'} " class="page-link" th:href="@{/post/allPostByTitle(title=${title},page=${currentPage +1})}" aria-label="Previous">
                <span aria-hidden="true">&raquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByCompanyName'} " class="page-link" th:href="@{/post/allPostByCompanyName(keySearchCompany=${keySearchCompany},page=${currentPage - 1})}" aria-label="Previous">
                <span aria-hidden="true">&raquo;</span>
            </a>
            <a th:if="${request == '/post/allPostByAddress'} " class="page-link" th:href="@{/post/allPostByAddress(address=${address},page=${currentPage + 1})}" aria-label="Previous">
                <span aria-hidden="true">&raquo;</span>
            </a>
            <a th:if="${request == '/post/postOfCompany'} " class="page-link" th:href="@{/post/postOfCompany(companyId=${companyId},page=${currentPage + 1})}" aria-label="Previous">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>

    </ul>
</nav>


</body>
</html>